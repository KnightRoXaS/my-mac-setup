---
- name: install zsh and friends
  become: true
  become_user: root
  package: name={{ item }}
  with_items:
    - zsh
    - zsh-completions
    - zsh-syntax-highlighting

- name: clone oh-my-zsh
  git: repo=https://github.com/robbyrussell/oh-my-zsh.git
    dest=/home/{{ username }}/.oh-my-zsh
    update=yes

- name: check if .zshrc exists
  stat: path=/home/{{ username }}/.zshrc
  register: zshrc

- name: back up existing .zshrc file if it exists
  when: zshrc.stat.exists
  copy: src=/home/{{ username }}/.zshrc
    dest=/home/{{ username }}/.zshrc-orig

- name: copy zshrc to user home
  copy: src=zshrc
    dest=/home/{{ username }}/.zshrc
    force=yes

- name: change user shell to zsh
  become: yes
  become_user: root
  command: chsh -s /bin/zsh "{{ username }}"
